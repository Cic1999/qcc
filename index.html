async function askGemini() {
    const userQuery = questionInput.value.trim();
    if (!userQuery) return;

    // 顯示使用者訊息
    createMessageElement(userQuery, 'user');

    questionInput.value = '';
    askButton.disabled = true;
    buttonText.textContent = '提問中...';
    loadingIndicator.classList.remove('hidden');

    const loadingBox = createMessageElement('', 'loading');

    try {
        const fetcher = () =>
            fetch(apiUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    contents: [
                        {
                            role: "user",
                            parts: [{ text: userQuery }]
                        }
                    ]
                })
            });

        const response = await fetchWithRetry(fetcher);
        const data = await response.json();

        // 拿出 Gemini 回答文字
        const reply =
            data.candidates?.[0]?.content?.parts?.[0]?.text ||
            "抱歉，我無法取得 Gemini 回覆。";

        loadingBox.remove();

        createMessageElement(reply, "gemini");

    } catch (error) {
        loadingBox.remove();
        createMessageElement("⚠ 無法取得回覆：" + error.message, "error");
    }

    askButton.disabled = false;
    buttonText.textContent = '提問';
    loadingIndicator.classList.add('hidden');
}
